{% extends "tienda/base.html" %}
{% load i18n %}
{% load static %}

{% block content %}
<div class="container mt-5 pt-5">
    <h2 class="mb-4 text-center">{% trans "Mi Carrito de Compras" %}</h2>

    {% if items %}
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th scope="col">{% trans "Producto" %}</th>
                        <th scope="col" class="text-center">{% trans "Cantidad" %}</th>
                        <th scope="col" class="text-end">{% trans "Precio Unitario" %}</th>
                        <th scope="col" class="text-end">{% trans "Subtotal" %}</th>
                        <th scope="col" class="text-center">{% trans "Acciones" %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in items %}
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <!-- Asumiendo que tienes un campo de imagen en tu modelo Producto -->
                                {% if item.producto.imagen %}
                                    <img src="{{ item.producto.imagen.url }}" alt="{{ item.producto.nombre }}" style="width: 60px; height: 60px; object-fit: cover;" class="me-3 rounded">
                                {% endif %}
                                <span>{{ item.producto.nombre }}</span>
                            </div>
                        </td>
                        <td class="text-center">
                            <div class="d-flex justify-content-center align-items-center">
                                <a href="{% url 'restar_carrito' item.producto.id %}" class="btn btn-outline-secondary btn-sm">-</a>
                                <span class="mx-3">{{ item.cantidad }}</span>
                                <a href="{% url 'agregar_carrito' item.producto.id %}" class="btn btn-outline-secondary btn-sm">+</a>
                            </div>
                        </td>
                        <td class="text-end">${{ item.producto.precio|floatformat:2 }}</td>
                        <td class="text-end">${{ item.subtotal|floatformat:2 }}</td>
                        <td class="text-center">
                            <a href="{% url 'eliminar_item_carrito' item.id %}" class="btn btn-danger btn-sm">
                                <i class="bi bi-trash"></i>{% trans "Quitar" %}</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="row justify-content-end mt-4">
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">{% trans "Total del Carrito" %}</h5>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between align-items-center">{% trans "Subtotal" %}<span>${{ carrito.subtotal_carrito|floatformat:2 }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Impuestos (IVA 19%)
                                <span>${{ carrito.impuestos|floatformat:2 }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center fw-bold">{% trans "Total" %}<span class="fs-5">${{ carrito.total_carrito|floatformat:2 }}</span>
                            </li>
                        </ul>
                        <div class="d-grid mt-3">
                            <a href="{% url 'realizar_pedido' %}" class="btn btn-primary">{% trans "Proceder al Pago" %}</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    {% else %}
        <div class="text-center py-5">
            <i class="bi bi-cart-x" style="font-size: 4rem; color: #ccc;"></i>
            <h3 class="mt-3">{% trans "Tu carrito está vacío" %}</h3>
            <p class="text-muted">{% trans "Añade productos para verlos aquí." %}</p>
            <a href="{% url 'listar_productos' %}" class="btn btn-primary mt-3">{% trans "Ver Productos" %}</a>
        </div>
    {% endif %}
</div>
{% endblock %}